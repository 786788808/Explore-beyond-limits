
### 目录：  
- 1. 项目背景及目的  
- 2. 数据探索(EDA)
- 3. 数据清洗  
- 4. 建模与模型评价分析
- 5. 总结

### 1. 项目背景及目的
#### 1.1 背景
在kaggle上看到一个关于预测流失用户的项目：      
一个银行经理因越来越多的客户在信用卡这一模块流失而感到困扰。他们希望有人能帮助预测哪部分客户即将流失，从而能提前采取有效措施挽回这部分客户，让客户留存下来。    
现有一个数据集，包含 10,000 多名客户信息，包含以下字段：年龄、薪水、婚姻状况、信用卡额度、信用卡类型等等，共计 18 个字段。    
数据集里只有 16.7% 的客户是流失客户，存在类别不均衡问题。
>
[获取数据地址](https://www.kaggle.com/sakshigoyal7/credit-card-customers/notebooks?datasetId=982921&sortBy=voteCount)  
>
#### 1.2 目的
- 建模预测即将流失用户
- 找出关键影响流失的因素，为银行经理提供合理建议  
>
### 2. 数据探索(EDA)
分类别型和数值型特征两大块做初步的了解,先读入数据：    
```
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# @Author  : Hush
# @Software: PyCharm

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
plt.rcParams['font.sans-serif'] = 'SimHei'
plt.rcParams['axes.unicode_minus'] = False
import seaborn as sns
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler  # 标准化
from sklearn.preprocessing import LabelEncoder  # 字符串编码
from imblearn.over_sampling import SMOTE  # 样本不均衡，用上采样


bank_churners_data = pd.read_csv(r'C:\Users\Administrator\Desktop\credit card customers\BankChurners.csv')
pd.set_option('display.max_columns', None)  # 显示所有列
pd.set_option('display.max_rows', None)  # 显示所有行
print(bank_churners_data.sample(5))
print(bank_churners_data.info())
print(bank_churners_data.describe(include='O'))
```

可以看到，数据集里一共有 10,127 行数据，23 个特征，缺失值以'unknown'字符串存在于数据集，数据类型有数值整型、数值浮点型、字符串。最后两列的数据、客户账号对数据分析没有实际作用，需要删除。     
```
bank_churners_data.drop(columns=['CLIENTNUM',
                                 'Naive_Bayes_Classifier_Attrition_Flag_Card_Category_Contacts_Count_12_mon_Dependent_count_Education_Level_Months_Inactive_12_mon_1',
                                 'Naive_Bayes_Classifier_Attrition_Flag_Card_Category_Contacts_Count_12_mon_Dependent_count_Education_Level_Months_Inactive_12_mon_2'],
                        inplace=True)
# print(bank_churners_data.info())
print('——————客户流失情况：——————')
print(bank_churners_data['Attrition_Flag'].value_counts())
churn = bank_churners_data['Attrition_Flag'].value_counts()
plt.pie(churn.values, labels=churn.index, autopct='%1.2f%%')
plt.show()
```
![](https://ftp.bmp.ovh/imgs/2021/01/92b48c60aa6ac979.png)  
流失客户占比不到16.1%，虽然类别失衡还没达到10倍数，但是后面还是要通过 Smote 来改善类别不平衡问题。   
下面了解一下各特征对流失的影响：  
#### 2.1 类别型特征
##### (2.1.1) 性别对客户留存的影响
```
print('客户性别分布情况：\n', bank_churners_data['Gender'].value_counts(ascending=True))
gen = bank_churners_data['Gender'].value_counts(ascending=True)
plt.figure(figsize=(10, 4))
plt.subplot(121)
plt.pie(gen.values, labels=gen.index, autopct='%1.2f%%')
plt.title('性别占比', fontsize=10)

plt.subplot(122)
sns.countplot(x='Attrition_Flag', data=bank_churners_data, hue='Gender', palette='Set3')
plt.xlabel('客户类型')
plt.ylabel('人数')
plt.title('各类别客户性别人数', fontsize=10)

plt.suptitle('性别对客户留存的影响')   # 添加一个总标题，前面的是小标题
plt.show()
```
![](https://ftp.bmp.ovh/imgs/2021/01/ef01bfd9164f2bb0.png)    
从图看出，女性客户占比较大，占总客户数的53%，比男性多5个百分点。    
在留存或流失客户群体中，女性客户数均比男性客户多。   

##### (2.1.2) 教育水平对客户留存的影响
降序排位，从大到小，给后面画图提供排序依据
```
plt.figure(figsize=(10, 5))
plt.subplot(121)
edu = bank_churners_data['Education_Level'].value_counts(ascending=False)
edu_percent = bank_churners_data['Education_Level'].value_counts(normalize=True, ascending=False)
print(edu)
print(edu_percent)
sns.countplot(x='Education_Level', data=bank_churners_data, order=edu.index, palette='Set3')
# plt.text(x=[1,2,3,4,5,6,7] , y=[1,2,3,4,5,6,7], s=edu_percent.values)  # 暂时不会加数据标签
plt.xlabel('教育水平')
plt.ylabel('人数')
plt.title('教育水平分布', fontsize=10)
plt.xticks(rotation=-25)  # 调整横坐标标签的倾斜程度，根据实际情况调整角度以显示清楚

plt.subplot(122)
sns.countplot(x='Education_Level', data=bank_churners_data, hue='Attrition_Flag', order=edu.index, palette='Set3')
plt.xlabel('教育水平')
plt.ylabel('人数')
plt.title('各类别客户教育水平', fontsize=10)
plt.xticks(rotation=-25)

plt.suptitle('教育水平对客户留存的影响')   # 添加一个总标题，前面的是小标题
plt.show()
```
![](https://ftp.bmp.ovh/imgs/2021/01/d857423f6f832f08.png)    
Graduate和High school这两部分占到总体的50%，有15%学历未知，15%没有接受过教育。其中，至少保证有70%的人都接受过教育。   
分类别来看教育水平情况，也没有很明显的信息说明哪个阶段的教育水平影响了客户的留存。  

##### (2.1.3) 婚姻状况对客户留存的影响
```
plt.figure(figsize=(10, 5))
plt.subplot(121)
edu = bank_churners_data['Marital_Status'].value_counts(ascending=False)
edu_percent = bank_churners_data['Marital_Status'].value_counts(normalize=True, ascending=False)
print(edu)
print(edu_percent)
sns.countplot(x='Marital_Status', data=bank_churners_data, order=edu.index, palette='Set3')
# plt.text(x=[1,2,3,4,5,6,7] , y=[1,2,3,4,5,6,7], s=edu_percent.values)  # 暂时不会加数据标签
plt.xlabel('婚姻状况')
plt.ylabel('人数')
plt.title('婚姻状况分布', fontsize=10)
# plt.xticks(rotation=-25)

plt.subplot(122)
sns.countplot(x='Marital_Status', data=bank_churners_data, hue='Attrition_Flag', order=edu.index, palette='Set3')
plt.xlabel('婚姻状况')
plt.ylabel('人数')
plt.title('各类别客户婚姻状况', fontsize=10)
# plt.xticks(rotation=-25)

plt.suptitle('婚姻状况对客户留存的影响')   # 添加一个总标题，前面的是小标题
plt.show()
```
![](https://ftp.bmp.ovh/imgs/2021/01/0e297a6def18c459.png)    
已经结婚的客户占46%,接近一半，单身客户占39%,有7%未知,其余7%是已经离婚的。  
在类别对比里，看到婚姻状况没有很明显影响客户的留存。  

##### (2.1.4) 收入水平对客户留存的影响
```
plt.figure(figsize=(10, 5))
plt.subplot(121)
edu = bank_churners_data['Income_Category'].value_counts(ascending=False)
edu_percent = bank_churners_data['Income_Category'].value_counts(normalize=True, ascending=False)
print(edu)
print(edu_percent)
sns.countplot(x='Income_Category', data=bank_churners_data, order=edu.index, palette='Set3')
# plt.text(x=[1,2,3,4,5,6,7] , y=[1,2,3,4,5,6,7], s=edu_percent.values)  # 暂时不会加数据标签
plt.xlabel('收入水平')
plt.ylabel('人数')
plt.title('收入水平情况', fontsize=10)
plt.xticks(rotation=-25)

plt.subplot(122)
sns.countplot(x='Income_Category', data=bank_churners_data, hue='Attrition_Flag', order=edu.index, palette='Set3')
plt.xlabel('收入水平')
plt.ylabel('人数')
plt.title('各类别客户收入水平情况', fontsize=10)
plt.xticks(rotation=-25)

plt.suptitle('收入水平对客户留存的影响')   # 添加一个总标题，前面的是小标题
plt.show()
```
![](https://ftp.bmp.ovh/imgs/2021/01/fe3ad982bfd96240.png)    
可以看到，收入少于40k的客户占35%，40-60K的占18%，80-120K占15%，60-80K的占14%，120K+的占7%，不知道收入水平的占11%。  
分类别来看，收入水平没有很明显地影响客户的留存。  

##### (2.1.5) 信用卡级别的对客户留存的影响
```
plt.figure(figsize=(10, 5))
plt.subplot(121)
edu = bank_churners_data['Card_Category'].value_counts(ascending=False)
edu_percent = bank_churners_data['Card_Category'].value_counts(normalize=True, ascending=False)
print(edu)
print(edu_percent)
sns.countplot(x='Card_Category', data=bank_churners_data, order=edu.index, palette='Set3')
# plt.text(x=[1,2,3,4,5,6,7] , y=[1,2,3,4,5,6,7], s=edu_percent.values)  # 暂时不会加数据标签
plt.xlabel('信用卡类型')
plt.ylabel('人数')
plt.title('信用卡类型', fontsize=10)
plt.xticks(rotation=-25)

plt.subplot(122)
sns.countplot(x='Card_Category', data=bank_churners_data, hue='Attrition_Flag', order=edu.index, palette='Set3')
plt.xlabel('信用卡类型')
plt.ylabel('人数')
plt.title('各类别客户信用卡类型', fontsize=10)
plt.xticks(rotation=-25)

plt.suptitle('信用卡类型对客户留存的影响')
plt.show()
```
![](https://ftp.bmp.ovh/imgs/2021/01/30aa5c4c83263d40.png)    
有93%的客户持有的都是蓝卡，银卡、金卡、铂金卡共占7%。  
分类别来看，信用卡类型并没有很明显地影响客户的留存。  

#### 2.2 数值型特征
##### (2.2.1) 年龄对客户留存的影响
```
print('客户年龄情况：', bank_churners_data['Customer_Age'].describe())
plt.figure(figsize=(12, 4))
plt.subplot(131)  # 现在画第一张
sns.distplot(bank_churners_data['Customer_Age'],
             kde_kws={'label': 'KDE 核密度曲线', 'linestyle': '--'})  # 设置核密度曲线
plt.xlabel('年龄')
plt.title('年龄分布', fontsize=10)

plt.subplot(132)   # 现在画第二张
sns.boxplot(x='Attrition_Flag', y='Customer_Age', data=bank_churners_data,
            width=0.7, palette='Set3')
plt.xlabel('客户类型')
plt.ylabel('年龄')
plt.title('不同类别客户年龄分布(1)', fontsize=10)

plt.subplot(133)   # 现在画第三张
sns.violinplot(x='Attrition_Flag', y='Customer_Age', data=bank_churners_data, palette='Set3')
plt.xlabel('客户类型')
plt.ylabel('年龄')
plt.title('不同类别客户年龄分布(2)', fontsize=10)

plt.suptitle('年龄对客户留存的影响')   # 添加一个总标题，前面的是小标题
plt.show()
```
![](https://ftp.bmp.ovh/imgs/2021/01/82bf7ad390cca0fb.png)    
看到，客户的年龄接近正态分布,最小年龄为26，最大年龄为73，平均数和中位数都是46，41-52岁的客户占到总人数的50%；  
从箱线图和小提琴图可以看到，流失客户的年龄中位数会比留存客户的大，但总的来看，两者的年龄分布比较接近，差别不大。  

##### (2.2.2) 相关联账户数量对客户留存的影响
```
print('相关联账户数量：', bank_churners_data['Dependent_count'].describe())
plt.figure(figsize=(12, 4))
plt.subplot(131)  # 现在画第一张
sns.distplot(bank_churners_data['Dependent_count'], kde=False)
plt.xlabel('相关联账户数')
plt.ylabel('人数')
plt.title('相关联账户数量分布', fontsize=10)

plt.subplot(132)   # 现在画第二张
sns.boxplot(x='Attrition_Flag', y='Dependent_count', data=bank_churners_data,
            width=0.7, palette='Set3')
plt.xlabel('客户类型')
plt.ylabel('相关联账户数')
plt.title('相关联账户数分布(1)', fontsize=10)

plt.subplot(133)   # 现在画第三张
sns.violinplot(x='Attrition_Flag', y='Dependent_count', data=bank_churners_data, palette='Set3')
plt.xlabel('客户类型')
plt.ylabel('相关联账户数')
plt.title('相关联账户数分布(2)', fontsize=10)

plt.suptitle('相关联账户数对客户留存的影响')   # 添加一个总标题，前面的是小标题
plt.show()
```
![](https://imgchr.com/i/slHq0I)  
每人平均拥有2-3个相关联账户，中位数是2。有50%的客户拥有相关联账户数在1-3个。  
分类别来看，流失用户有50%集中于2-3个相关联的账户(箱线图箱体比较扁)，存在个别异常值。留存用户有50%客户集中于1-3个相关账户。总的来看，看不出相关联账户数对客户留存的影响。  

##### (2.2.3) 其余数值型特征对客户流失的影响
看看其余12个数值型特征:  
```
other_numerical_fea = ['Months_on_book', 'Total_Relationship_Count', 'Months_Inactive_12_mon', 'Contacts_Count_12_mon',
                 'Credit_Limit', 'Total_Revolving_Bal', 'Avg_Open_To_Buy', 'Total_Amt_Chng_Q4_Q1',
                 'Total_Trans_Amt', 'Total_Trans_Ct', 'Total_Ct_Chng_Q4_Q1', 'Avg_Utilization_Ratio']
# print(len(other_numerical_fea))

for i in other_numerical_fea:
    print('特征%s的分布情况:' % i, bank_churners_data[i].describe())
    plt.figure(figsize=(12, 4))
    plt.subplot(131)                             
    # 不同值较多的特征才画核密度线：
    if bank_churners_data[i].nunique() > 20:
        sns.distplot(bank_churners_data[i])
    else:
        sns.distplot(bank_churners_data[i], kde=False)

    plt.subplot(132)
    sns.boxplot(x='Attrition_Flag', y=i, data=bank_churners_data,
                width=0.7, palette='Set3')

    plt.subplot(133)
    sns.violinplot(x='Attrition_Flag', y=i, data=bank_churners_data, palette='Set3')

    plt.suptitle('特征%s对客户留存的影响'%i)
    plt.show()
```

![](https://s3.ax1x.com/2021/01/11/s8u0Z4.png)     
![](https://s3.ax1x.com/2021/01/11/s8uvwQ.png)  
![](https://s3.ax1x.com/2021/01/11/s8KPS0.png)  
![](https://s3.ax1x.com/2021/01/11/s8KkOU.png)    
![](https://s3.ax1x.com/2021/01/11/s8Kuf1.png)    
![](https://s3.ax1x.com/2021/01/11/s8KUfI.png)    
![](https://s3.ax1x.com/2021/01/11/s8K06f.png)    
![](https://s3.ax1x.com/2021/01/11/s8Kckj.png)    
![](https://s3.ax1x.com/2021/01/11/s8K2hn.png)    
![](https://s3.ax1x.com/2021/01/11/s8KoBF.png)    
![](https://s3.ax1x.com/2021/01/11/s8KT74.png)    
![](https://s3.ax1x.com/2021/01/11/s8KO91.png)    



https://cj.sina.com.cn/articles/view/2095452301/7ce6108d01900afck

